<%# Overrides ArcLight Core partial. %>
<%# Last checked for updates: ArcLight v0.3.0. %>
<%# https://github.com/projectblacklight/arclight/blob/master/app/views/catalog/_show_default.html.erb %>

<% content_for(:sidebar) do %>
  <div class='row'>
    <div class='col-md-12' id='context'>

      <%# ========================== %>
      <%# Collection Overview Nav    %>
      <%# ========================== %>
      <%# Adapted from:%>
      <%#  https://github.com/projectblacklight/arclight/blob/master/app/views/catalog/_collection_context_nav.html.erb %>

      <div class="actions-wrapper  d-flex">

        <%= render partial: 'arclight/requests', locals: { document: document } %>

        <div class='al-show-actions-box-bookmarks flex-md-fill'>
          <%= render partial: 'catalog/bookmark_control', locals: { document: document } %>
        </div>

      </div>

      <ul class='nav flex-column'>
        <% unless blacklight_config.show.metadata_partials.nil? %>
          <% blacklight_config.show.metadata_partials.each do |item| %>
            <% next unless fields_have_content?(collection_doc(document), item) %>
            <li class='nav-item'>
              <%= link_to t("arclight.views.show.sections.#{item}"),
                [
                  solr_document_path(document.eadid),
                  "##{t("arclight.views.show.sections.#{item}").parameterize}"
                ].join, class: 'nav-link'
              %>
            </li>
          <% end %>
        <% end %>
      </ul>

      <hr/>

      <%# ========================= %>
      <%# Hierarchy Tree Navigation %>
      <%# ========================= %>
      <div class='tab-content'>
        <div class='tab-pane active'>
          <%= render 'component_context' %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<%# =================== %>
<%# upper breadcrumbs   %>
<%# =================== %>
<%# this is from arclight core /app/views/shared/_show_breadcrumbs.html.erb
-- with some small tweaks %>

<% parents = Arclight::Parents.from_solr_document(document).as_parents %>
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home-link">
      <%= link_to t('arclight.routes.home'), root_path %>
    </li>

    <li class="breadcrumb-item  breadcrumb-item-1">
      <% if document.repository_config.present? %>
        <%= link_to(document.repository_config.name, arclight_engine.repository_path(document.repository_config.slug)) %>
      <% else %>
        <%= t('arclight.show_breadcrumb_label') %>
      <% end %>
    </li>

    <% parents.each_with_index.map do |parent, index| %>
      <%= content_tag :li, class: "breadcrumb-item breadcrumb-item-#{index + 1}" do %>
        <%= link_to parent.label, solr_document_path(parent.global_id) %>
      <% end %> 
    <% end %>

    <%= content_tag :li, class: "breadcrumb-item breadcrumb-item-#{parents.length + 2}" do %>
      <%= document.normalized_title %>
    <% end %>

  </ol>
</nav>



<%# ===================== %>
<%# Collection Masthead   %>
<%# ===================== %>
<div class='row collection-banner'>
  <div class='col-auto'>
    <%= content_tag :div, class: "collection-name-wrapper" do %>
      <%= link_to document.collection_name, solr_document_path(document.eadid) %>
    <% end %>

    <h1><%= document.normalized_title %></h1>

  </div>
</div>


<%# ================ %>
<%# upper metadata   %>
<%# ================ %>
<%= render_document_partial(document, :show_upper_metadata) %>

<% parents = Arclight::Parents.from_solr_document(document).as_parents %>

<% if document.level == 'collection' %>
  <div>
    <%# ========================== %>
    <%# Collection Overview        %>
    <%# ========================== %>
    <%# Adapted from: %>
    <%# https://github.com/projectblacklight/arclight/blob/master/app/views/catalog/_collection_context.html.erb %>

    <% unless blacklight_config.show.metadata_partials.nil? %>
      <% blacklight_config.show.metadata_partials.each do |metadata| %>
        <% next unless fields_have_content?(@document, metadata) %>
        <%= render partial: 'custom_metadata',
          locals: { document: @document, field_accessor: metadata } %>
      <% end %>
    <% end %>
  </div>
<% end %>

<% if document.digital_objects.present? %>

  <%# ==================================== %>
  <%# DAOs on This Level (Not Descendants) %>
  <%# ==================================== %>

  <%# TODO: account for the possibility of a mix of DDR & non-DDR DAOs present %>
  <%# on the same component. %>
  <%# TODO: Apply this logic for top (collection) level DAOs as well. %>

  <div class='row'>
    <div class='col-md-12'>
      <h2><%= t('arclight.views.show.online_content') %> <span class="media-body al-online-content-icon" aria-hidden="true"><%= blacklight_icon :online %></span></h2>

      <%# Single DAO with DUL specific role: render respective DUL viewer %>
      <% if ['audio-streaming', 'image-service', 'video-streaming',
              'web-resource-link'].include? document.dao_single_role %>
        <%= render partial: ['arclight/viewers/', document.dao_single_role].join,
              locals: { document: @document } %>

      <%# Multiple DAOs pointing to DDR links: render a link to DDR search %>
      <% elsif document.multiple_ddr_daos? %>
        <%= render partial: 'arclight/viewers/multi-ddr-link', locals: { document: @document } %>

      <%# Fall back to default ArcLight core DAO viewer %>
      <% else %>
        <%= render_document_partial(document, 'arclight_viewer') %>
      <% end %>
    </div>
  </div>
<% end %>

<% if document.children? %>

  <%# ========================== %>
  <%# Child Components           %>
  <%# ========================== %>

  <h2>Contents</h2>
  <%= content_tag(
    :div, '',
    class: 'al-contents child-components',
    data: {
      arclight: {
        path: search_catalog_path,
        name: document.collection_name,
        view: 'child_components',
        parent: document.reference,
        directparent: document.reference,
        search_field: 'within_collection',
        per_page: '100'
      }
    }
  ) %>
<% end %>

<!--

<%# ==================================== %>
<%# DAOs in Descendant Nodes             %>
<%# ==================================== %>
<%# Hide for now. TBD how to render      %>

<% if document.online_content? && document.children? %>
  <div class='row'>
    <div class='col-md-12' id='online-content'>
      <h2><%= t('arclight.views.show.online_content') %></h2>
      <%= content_tag(
        :div, '',
        class: 'al-contents',
        data: {
          arclight: {
            path: search_catalog_path,
            name: document.collection_name,
            access: 'online',
            view: 'online_contents',
            parent: document.reference,
            search_field: 'within_collection'
          }
        }
      ) %>

    </div>
  </div>
<% end %>
-->


<%# ========================== %>
<%# Access Terms               %>
<%# ========================== %>
<%# TBD: better rendering with %>
<%# separate self vs inherited %>
<%# restrictions.              %>

<div class='row'>
  <div class='col-md-12' id='access'>
    <hr/>
    <h2><%= t 'arclight.views.show.access' %></h2>
    <% unless blacklight_config.show.component_access_tab_items.nil? %>
      <% items = blacklight_config.show.component_access_tab_items.select { |i|  fields_have_content?(@document, i) }  %>
      <% items.each_with_index do |item, index| %>
        <%= render partial: 'access_contents', locals: { document: @document, field_accessor: item, card_index: index} %>
      <% end %>
    <% end %>
  </div>
</div>
